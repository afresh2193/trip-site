<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trip Gallery</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f2f2f2;
}
header {
  text-align: center;
  padding: 30px 20px 20px 20px;
}
header h1 {
  margin: 0;
  font-size: 36px;
  color: #333;
}
.trip-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  padding: 20px;
  margin: 0 auto;
  max-width: 1200px;
  gap: 20px;
}
.trip-info, .trip-cover, .trip-map {
  background: #fff;
  padding: 15px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  border-radius: 6px;
}
.trip-info { flex: 1 1 200px; min-width: 200px; }
.trip-info p { margin: 5px 0; }
.trip-cover { flex: 1 1 400px; text-align: center; }
.trip-cover img { width: 100%; max-height: 300px; object-fit: cover; border-radius: 0; }
.trip-map { flex: 1 1 300px; min-width: 300px; height: 300px; }

/* WriteUp section (below top components, above banner) */
.writeup-section {
  margin: 20px auto;
  max-width: 1200px;
  background: #fff;
  padding: 25px 20px;
  border-radius: 6px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  font-size: 16px;
  line-height: 1.6;
  color: #333;
  white-space: pre-wrap; /* preserve line breaks from Google Sheet */
}

.banner {
  margin: 20px auto;
  max-width: 1200px;
  padding: 15px;
  text-align: center;
  background-color: #444;
  color: #fff;
  font-size: 18px;
}

.photos-container {
  margin: 20px auto;
  max-width: 1200px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}
.photos-container img {
  width: 100%;
  max-width: 900px;
  border-radius: 0;
  object-fit: cover;
  opacity: 0;
  transition: opacity 0.5s ease-in;
}
.photos-container img.loaded {
  opacity: 1;
}

@media (max-width: 900px) {
  .trip-container { flex-direction: column; }
  .trip-map, .trip-cover, .trip-info { min-width: 100%; }
}
</style>
</head>
<body>

<header>
  <h1 id="trip-title">Loading...</h1>
</header>

<div class="trip-container">
  <div class="trip-info" id="trip-info"></div>
  <div class="trip-cover" id="trip-cover"></div>
  <div class="trip-map" id="trip-map"></div>
</div>

<!-- WriteUp goes below top components and above banner -->
<div class="writeup-section" id="trip-writeup">
  <!-- Populated from WriteUp column -->
</div>

<div class="banner">
  Your small banner text goes here
</div>

<div class="photos-container" id="photos-container"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwoUNNQZsKfLkEYcc4DfyVQkzuc3BGGXd-DDV0dAfMHhhE5i_FY3Bq5z8PBUhg2teot/exec";
const params = new URLSearchParams(window.location.search);
const slug = params.get('slug');

function initTripGallery() {
  fetch(SCRIPT_URL)
    .then(res => res.json())
    .then(data => {
      const trip = data.cardItems.find(t => t.title.toLowerCase().replace(/\s+/g,'-') === slug);
      if(!trip){
        document.getElementById("trip-title").innerText = "Trip not found";
        return;
      }

      // Title
      document.getElementById("trip-title").innerText = trip.title;

      // Left info column
      document.getElementById("trip-info").innerHTML = `
        <p><strong>Date:</strong> ${trip.date}</p>
        <p><strong>Area:</strong> ${trip.area}</p>
        <p><strong>Miles:</strong> ${trip.miles}</p>
        <p><strong>Elevation Gain:</strong> ${trip.elevationGain}</p>
        <p><strong>Type:</strong> ${trip.type}</p>
      `;

      // Cover photo (from imageUrl column)
      document.getElementById("trip-cover").innerHTML = `<img src="${trip.imageUrl}" alt="${trip.title}" loading="lazy">`;

      // Map
      const mapDiv = document.getElementById("trip-map");
      const map = new google.maps.Map(mapDiv, {
        center: { lat: trip.position.lat, lng: trip.position.lng },
        zoom: 10,
        mapTypeId: google.maps.MapTypeId.TERRAIN,
        disableDefaultUI: true,
        gestureHandling: "greedy"
      });
      new google.maps.Marker({
        position: { lat: trip.position.lat, lng: trip.position.lng },
        map: map
      });

      // WriteUp text
      document.getElementById("trip-writeup").innerText = trip.WriteUp || "";

      // All photos from Imagefolder column
      const urls = data.images[slug] || [];
      const photosContainer = document.getElementById("photos-container");
      photosContainer.innerHTML = urls.map(u => `<img src="${u}" alt="${trip.title}" loading="lazy" class="loaded">`).join("");
    })
    .catch(err => {
      console.error(err);
      document.getElementById("trip-title").innerText = "Failed to load trip data";
    });
}

// Load Google Maps dynamically
function loadGoogleMaps() {
  const script = document.createElement('script');
  script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyCMCxxUBxZ-a2UyHwu5PbKwYBxvAo0bAAA&callback=initTripGallery";
  script.defer = true;
  document.head.appendChild(script);
}

// Start
loadGoogleMaps();
</script>

</body>
</html>
