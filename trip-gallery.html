<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trip Gallery</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f2f2f2;
}
header {
  text-align:center;
  padding:30px 20px 20px 20px;
}
header h1 {
  margin:0;
  font-size:36px;
  color:#333;
}
.trip-container {
  display:flex;
  flex-wrap:wrap;
  justify-content:space-between;
  padding:20px;
  margin:0 auto;
  max-width:1200px;
  gap:20px;
}
.trip-info, .trip-cover, .trip-map {
  background:#fff;
  padding:15px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
.trip-info {
  flex:1 1 200px;
  min-width:200px;
}
.trip-info p {
  margin:5px 0;
}
.trip-cover {
  flex:1 1 400px;
  text-align:center;
}
.trip-cover img {
  width:100%;
  max-height:300px;
  object-fit:cover;
  border-radius:0;
}
.trip-map {
  flex:1 1 300px;
  min-width:300px;
  height:300px;
}
.banner {
  margin:20px auto;
  max-width:1200px;
  padding:15px;
  text-align:center;
  background-color:#444;
  color:#fff;
  font-size:18px;
}
.photos-container {
  margin:20px auto;
  max-width:1200px;
  display:flex;
  flex-direction:column;
  gap:20px;
}
.photos-container img {
  width:100%;
  border-radius:0;
  loading:lazy;
}
@media (max-width:900px){
  .trip-container { flex-direction:column; }
  .trip-map, .trip-cover, .trip-info { min-width:100%; }
}
</style>
</head>
<body>

<header>
  <h1 id="trip-title">Loading...</h1>
</header>

<div class="trip-container">
  <div class="trip-info" id="trip-info"></div>
  <div class="trip-cover" id="trip-cover"></div>
  <div class="trip-map" id="trip-map"></div>
</div>

<div class="banner">
  Your small banner text goes here
</div>

<div class="photos-container" id="photos-container"></div>

<!-- Config file -->
<script src="config.js"></script>
<!-- Google Maps API (dynamic key) -->
<script src="https://maps.googleapis.com/maps/api/js?key=" + CONFIG.GOOGLE_MAPS_KEY></script>

<script>
(async function(){
  try {
    const params = new URLSearchParams(window.location.search);
    const slug = params.get('slug');
    if(!slug) throw new Error("No slug in URL");

    const res = await fetch(CONFIG.SCRIPT_URL);
    const data = await res.json();

    const trip = data.cardItems.find(t => t.title.toLowerCase().replace(/\s+/g,'-') === slug);
    if(!trip) {
      document.getElementById("trip-title").innerText = "Trip not found";
      return;
    }

    // Title
    document.getElementById("trip-title").innerText = trip.title;

    // Info column
    const infoHtml = `
      <p><strong>Date:</strong> ${trip.date}</p>
      <p><strong>Area:</strong> ${trip.area}</p>
      <p><strong>Miles:</strong> ${trip.miles}</p>
      <p><strong>Elevation Gain:</strong> ${trip.elevationGain}</p>
      <p><strong>Type:</strong> ${trip.type}</p>
    `;
    document.getElementById("trip-info").innerHTML = infoHtml;

    // Cover photo
    const firstPhoto = trip.imageUrl.split(",")[0].trim();
    document.getElementById("trip-cover").innerHTML = `<img src="${firstPhoto}" alt="${trip.title}">`;

    // Map
    const mapDiv = document.getElementById("trip-map");
    const map = new google.maps.Map(mapDiv, {
      center: { lat: trip.position.lat, lng: trip.position.lng },
      zoom: 10,
      mapTypeId: google.maps.MapTypeId.TERRAIN,
      disableDefaultUI: false,
      gestureHandling: "greedy"
    });
    new google.maps.Marker({
      position: { lat: trip.position.lat, lng: trip.position.lng },
      map: map
    });

    // All photos
    const photosDiv = document.getElementById("photos-container");
    const urls = trip.imageUrl.split(",");
    photosDiv.innerHTML = urls.map(u => `<img src="${u.trim()}" alt="${trip.title}" loading="lazy">`).join("");

  } catch(e){
    console.error(e);
    document.getElementById("trip-title").innerText = "Failed to load trip data";
  }
})();
</script>

</body>
</html>
