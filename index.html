<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hike Map</title>
  <style>
    html, body { height: 100%; margin: 0; font-family: Arial, sans-serif; }
    #map { height: 100%; width: 100%; }
    .sidebar {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 300px;
      max-height: 90%;
      overflow-y: auto;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      z-index: 10;
    }
    .sidebar img {
      width: 100%;
      height: auto;
      margin-bottom: 10px;
      border-radius: 6px;
    }
    .sidebar h2 { margin-top: 0; margin-bottom: 5px; }
    .sidebar p { margin: 2px 0; font-size: 14px; }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCMCxxUBxZ-a2UyHwu5PbKwYBxvAo0bAAA"></script>
</head>
<body>
  <div id="map"></div>
  <div class="sidebar" id="sidebar" style="display:none;">
    <img id="sidebar-image" src="" alt="">
    <h2 id="sidebar-title"></h2>
    <p id="sidebar-type"></p>
    <p id="sidebar-miles"></p>
    <p id="sidebar-elevation"></p>
    <p id="sidebar-ranking"></p>
    <a id="sidebar-link" href="" style="display:block;margin-top:10px;">View Trip Page</a>
  </div>

  <script>
    const sheetURL = 'https://script.google.com/macros/s/AKfycbyQ_0S5zch7LX5glhYN2k5HSxLruPkqbbMXNZ4YpGs_sMtD3XxP3ha726rC0o_Po878/exec';

    fetch(sheetURL)
      .then(res => res.json())
      .then(data => {
        const { cardItems } = data;

        const map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: 39.5, lng: -98.35 }, // Center of US
          zoom: 4
        });

        const sidebar = document.getElementById('sidebar');
        const imgEl = document.getElementById('sidebar-image');
        const titleEl = document.getElementById('sidebar-title');
        const typeEl = document.getElementById('sidebar-type');
        const milesEl = document.getElementById('sidebar-miles');
        const elevEl = document.getElementById('sidebar-elevation');
        const rankEl = document.getElementById('sidebar-ranking');
        const linkEl = document.getElementById('sidebar-link');

        cardItems.forEach(hike => {
          // Make sure Lat/Long exist
          const lat = parseFloat(hike.Lat);
          const lng = parseFloat(hike.Lng);
          if (isNaN(lat) || isNaN(lng)) return;

          const marker = new google.maps.Marker({
            position: { lat, lng },
            map,
            title: hike.title
          });

          marker.addListener('click', () => {
            sidebar.style.display = 'block';
            imgEl.src = hike.imageUrl || ''; // Only show Imageurl from sheet
            imgEl.alt = hike.title;
            titleEl.textContent = hike.title;
            typeEl.textContent = 'Type: ' + (hike.type || 'N/A');
            milesEl.textContent = 'Miles: ' + (hike.miles || 0);
            elevEl.textContent = 'Elevation Gain: ' + (hike.elevationGain || 0);
            rankEl.textContent = 'Overall Ranking: ' + (hike.overallRanking || 0);
            linkEl.href = `trip.html?slug=${hike.slug}`;
          });
        });
      })
      .catch(err => console.error(err));
  </script>
</body>
</html>
